


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <script src="https://cdn.bootcss.com/vue/2.2.2/vue.min.js"></script> -->
    <script src="vue.js"></script>

  
    <title>Document</title>
    <style>
        @page {
            margin: 0;
        }
        .a {
            padding-left: 100px;
        }
        .w25{
            width:25%;
        }

        .centered{

            text-align:center;
        }
    </style>
</head>

<body>


    <div id='app'>
<div v-if="print_paper.mode">
    <input class="w25" type="button" id="isat-bold" value="bold">
        <input class="w25"  type="button" id="isat-italic" value="italic">
        <input class="w25"  type="button" id="isat-header-1" value="header large">
        <input class="w25"  type="button" id="isat-header-2" value="header small">
        <!-- <input type="button" id="isat-header-2" value="b">-->
        <input class="w25"  type="button" id="isat-subscript" value="subscript"> 
   
        <input class="w25"  type="button" id="isat-superscript" value="superscript">
        <input class="w25"  type="button" id="isat-p" value="Paragraph">
        <input class="w25"  type="button" id="isat-underline" value="undelrine">
        <input class="w25"  type="button" id="isat-left" value="left">
        <input class="w25"  type="button" id="isat-center" value="center">
        
        <input class="w25"  type="button" id="isat-right" value="right">
        <input class="w25"  type="button" id="isat-jfull" value="Justify">

        <input class="w25"  type="button" id="isat-boost_insertUnorderedList" value="UnorderList">
        <input class="w25"  type="button" id="isat-insertOrderedList" value="OrderList">
    </div>
        
        
        
        
        
        
        <!-- {{sales}} -->
<!-- {{print_paper}} -->
        <!-- {{test}}
        {{add_to_cart}}
        {{sales}} -->
        <!-- <div class="a" v-for="v in add_to_cart">{{v}}</div> -->
    <!-- {{paper_setup}} -->
    <div class="ticket">
        <!-- <div v-if="mode" parm="pos_header" class="pos_header centered isat_editable_content" isat_editable_content="isat_editable_content" v-html="print_paper.company_info.header" ></div>  

        <div v-else class="centered"  v-html="print_paper.company_info.header" ></div>   -->
<h1 style="text-align: center;">{{print_paper.company_info.brand_name}}</h1>
<p style="text-align: center">{{print_paper.company_info.address}}</p>
<p  v-if="print_paper.isFieldActive.email" style="text-align: center">{{print_paper.company_info.email}}</p>
<p  v-if="print_paper.isFieldActive.contact" style="text-align: center">{{print_paper.company_info.contact}}</p>
<p  v-if="print_paper.isFieldActive.gst_no" style="text-align: center">GSTIN: {{print_paper.company_info.gst_no}}</p>


<!-- creator {{print_paper.company_info}} -->

        <!-- {{print_paper.company_info.header}} -->
        <!-- <h1 class="centered">ANGALWARE</h1> -->
<!-- <div class="centered" isat_editable_content="isat_editable_content" class="isat_editable_content" v-html="print_paper.header.brand_name">ANGALWARE</div>   -->
        <!-- <p class="centered" v-html="print_paper.header.address">35b poonamalee main road 
            <br>kattuppakam
             chennai-600056
<p class="centered" v-html="print_paper.header.contact">6380188237,9514242221
</p>
<p class="centered" v-html="print_paper.header.gst_no">123 -->
<!-- </p> -->
<hr style="border: 1px dashed black;">
<table style="width: 100%;">
    <tbody style="width:100%">
        <tr style="width:100%">
            <td style="width:20%">Bill NO </td>
            <td style="width:1%"> : </td>
            <td style="width:28%">{{print_paper.sales.invoice_no}}</td>
            <td style="width:2%"></td>
            <td style="width:20%">Cashier </td>
            <td  style="width:1%"> :</td>
             <td style="width:28%">{{print_paper.sales.salesman.name}}</td>
        </tr>
        <tr style="width:100%">
            <td style="width:20%">Date</td>
            <td style="width:1%"> : </td>
            <td style="width:28%">{{print_paper.sales.date}}</td>
            <td style="width:2%"></td>
            <td style="width:20%">Time </td>
            <td  style="width:1%"> :</td>
             <td style="width:28%">{{getTime_()}}</td>
        </tr>

        <tr style="width:100%">
            <td style="width:20%">Counter</td>
            <td style="width:2%"> : </td>
            <td style="width:78%">{{print_paper.sales.counter_id}}</td>
            <!-- <td style="width:10%"></td>
            <td style="width:20%"></td>
            <td  style="width:5%"></td>
             <td style="width:20%"></td> -->
        </tr>



    </tbody>
</table>

<hr style="border: 1px dashed black;">

        <table style="width:100%">
            <thead>
                <tr style="border: 1px solid black;">
                    <th class="quantity">#</th>
                    <th style="width:30%" class="description">Name</th>
                    <th v-if="print_paper.isFieldActive.mrp" class="price">Mrp</th>
                    <th>Price</th>
                    <th v-if="print_paper.isFieldActive.discount" class="price">Dis(%)</th>
                    <th class="price">Qty</th>
                    <th class="price">Unit</th>
                    
                </tr>

            </thead>

            <tbody>

                <tr v-for="(item,index) in print_paper.add_to_cart" :key="'add_to_cart'+index">
                    <td class="quantity">{{index+1}}</td>
                    <td style="width:30%" class="description">{{item.name}}</td>
                    <td v-if="print_paper.isFieldActive.mrp" class="description">{{item.mrp||'-'}}</td>
                    <td>{{ parseFloat(item.sales_rate).toFixed(2) }}</td>

    
                    <td v-if="print_paper.isFieldActive.discount" class="description">{{item.sales_discount||0}}</td>
                                  <td class="price">{{item.qty}}</td>
                    <td class="price">{{item.unit}}</td>
                </tr>

            </tbody>


        </table>

       <!-- --------------------------------------------table-----------------------------  -->
       <!-- <div v-if="paper_setup.est_type=='est_type_1'">

       <table style="width: 100%;" >
    


    <tr>
        <td style="width:80%"></td>
    <td style="width: 20%;"><b> Total:</b>   {{print_paper.payment_info.total_amount}}</td>
    </tr>

        <td style="width:80%"></td>
    <td style="width: 20%;"><b> Balance Due:</b>{{print_paper.payment_info.balance_due}}</td>
    </tr>
    <tr>
        <td style="width:80%"></td>
    <td style="width: 20%;"><b> Cash Received:</b>{{print_paper.payment_info.cash_received}}</td>
    </tr>
    <tr>
</table>


        <table style="border-collapse:collapse;width: 100%;border:1px solid black"> -->
<!-- <thead>
    <tr style="width: 100%;border:1px solid black">
        <td style="width:25%;text-align: center;">GST%</td>
        <td style="width:25%;text-align: center;">Goods</td>
        <td style="width:25%;text-align: center;">CGST AMT</td>
      <td style="width:25%;text-align: center;">SGST AMT</td>

      <td style="width:25%;text-align: center;">IGST AMT</td>


    </tr>
</thead>
    <tbody> -->
        <!-- <tr style="border:1px solid black">
            <td style="width:25%;text-align: center;">{{print_paper.final_tax.total_tax_amt}}</td>
            <td style="width:25%;text-align: center;">{{print_paper.payment_info.subtotal}}</td>
            <td style="width:25%;text-align: center;">{{print_paper.final_tax.cgst_amt}}</td>
          <td style="width:25%;text-align: center;">{{print_paper.final_tax.sgst_amt}}</td>
          <td style="width:25%;text-align: center;">{{print_paper.final_tax.igst_amt}}</td>
    
    
        </tr> -->
    <!-- </tbody>
</table>
</div> -->
<!-- ------------------------------------------------type 1-------------------------------- -->


<!-- --------------------------------------type2-------------------------- -->
<!-- 
<div v-if="paper_setup.est_type=='est_type_2'">
        <hr style="border: 1px dashed black;">
        <table style="width: 100%;">
            <tbody style="width:100%">
                <tr style="width:100%">
                    <td style="width: 50%;"></td>

                    <td style="width:30%">Sub Total:</td>
                    <td style="width:20%">{{print_paper.sales.final_info.subtotal }} </td>
                </tr>
                <tr style="width:100%">
                    <td style="width: 50%;"></td>

                    <td style="width:30%">Discount Amt:</td>
                    <td style="width:20%"> {{print_paper.sales.final_info.discount }} </td>
                </tr>
                <tr style="width:100%">
                    <td style="width: 50%;"></td>

                    <td style="width:30%">CGST:</td>
                    <td style="width:20%"> {{print_paper.sales.final_info.cgst_amt}} </td>
                </tr>
                <tr style="width:100%">
                    <td style="width: 50%;"></td>

                    <td style="width:30%">SGST</td>
                    <td style="width:20%"> {{print_paper.sales.final_info.sgst_amt}} </td>
                </tr>

                <tr style="width:100%">
                    <td style="width: 50%;"></td>

                    <td style="width:30%">Total:</td>
                    <td style="width:20%">{{print_paper.sales.final_info.total_amount}} </td>
                </tr>

                <tr style="width:100%">
                    <td style="width: 50%;"></td>

                    <td style="width:30%">Balance Due:</td>
                    <td style="width:20%"> {{print_paper.sales.final_info.balance_due}} </td>
                </tr>


                <tr style="width:100%">
                    <td style="width: 50%;"></td>

                    <td style="width:30%">                Cash Received:
                    </td>
                    <td style="width:20%"> {{print_paper.final_info.cash_received}}</td>
                </tr>
            </tbody>
        </table>
        
        

    </div> -->
<!-- ---------------------------------------------type 2---------------------------------- -->

<!-- ----------------------------------------------type 3--------------------------------- -->
        <!-- <table style="width: 100%;border: 1px solid black;padding:10px" v-if="paper_setup.est_type=='est_type_3'">
            <tbody style="width:100%">
                <tr style="width:100%">

                    <td style="width:50%">Sub Total:</td>
                    <td style="width:50%;text-align: right;"> {{print_paper.payment_info.subtotal}} </td>
                </tr>
                <tr style="width:100%">

                    <td style="width:50%">Discount :</td>
                    <td style="width:50%;text-align: right;"> {{print_paper.payment_info.discount}} </td>
                </tr>
                <tr style="width:100%">

                    <td style="width:50%">CGST:</td>
                    <td style="width:50%;text-align: right;">{{print_paper.final_tax.cgst_amt}}</td>
                </tr>
                <tr style="width:100%">

                    <td style="width:50%">SGST:</td>
                    <td style="width:50%;text-align: right;"> {{print_paper.final_tax.sgst_amt}}</td>
                </tr>

                <tr style="width:100%">
                    
                    <td style="width:50%">Total:</td>
                    <td style="width:50%;text-align: right;">{{print_paper.payment_info.total_amount}} </td>
                </tr>

                <tr style="width:100%">
                    
                    <td style="width:50%">Balance Due:</td>
                    <td style="width:50%;text-align: right;"> {{print_paper.payment_info.balance_due}} </td>
                </tr>


                <tr style="width:100%">

                    <td style="width:50%">Cash Received:
                    </td>
                    <td style="width:50%;text-align: right;"> {{print_paper.payment_info.cash_received}}</td>
                </tr>
            </tbody>
        </table> -->


<!-- ----------------------------------------type 3----------------------------------- -->



<hr style="border: 1px dashed black;">

<table>
    <tr>
        <!-- {{print_paper.sales.final_info}} -->
        <td> 
            <div v-if="print_paper.isFieldActive.no_of_items">     <b>No of Items</b>:{{no_of_items(print_paper.add_to_cart)}}<br></div>
            <div  v-if="print_paper.isFieldActive.total_item_quantity">  <b>Total Quantity</b>:{{total_item_quantity(print_paper.add_to_cart)}}<br></div>
            <div v-if="print_paper.isFieldActive.round_amount"> <b>Round</b>:{{print_paper.sales.final_info.round_amount_in_total}}<br></div>

<div v-if="print_paper.isFieldActive.paid_amount"> <b>Paid Amount</b>:{{print_paper.sales.final_info.paid_amount}}<br></div>
<div> <b>Total Amount</b>:{{Math.ceil(print_paper.sales.final_info.total_amount)}}<br></div>
<div v-if="print_paper.isFieldActive.balance_due"> <b>Balance Amount</b>:{{print_paper.sales.final_info.balance_due}}<br></div>
        </td>
    </tr>
</table>
<!-- {{print_paper.field.tax_type}} -->

<hr style="border: 1px dashed black;">
<div v-if="print_paper.isFieldActive.tax_detail">
<div v-if="print_paper.field.tax_type=='simple'">
<div>Goods   :{{print_paper.sales.final_info.total_amount}} <br></div>
<div>Cgst(Amt):{{simple_tax_calculation(print_paper.add_to_cart).cgst_amt}}<br></div>
<div>Sgst(Amt):{{simple_tax_calculation(print_paper.add_to_cart).sgst_amt}}<br></div>
<div>Igst (Amt):{{simple_tax_calculation(print_paper.add_to_cart).igst_amt}}<br></div>
<div>Cess (Amt):{{simple_tax_calculation(print_paper.add_to_cart).cess_amt}}<br></div>
</div>


<div v-if="print_paper.field.tax_type=='each'">
    <div>Goods   :{{print_paper.sales.final_info.total_amount}} <br></div>
    <div v-for="(item,index) in print_paper.add_to_cart" :key="'ke'+index">
    <div v-if="item.cgst!=0">Cgst@{{item.cgst}}(Amt):{{item.cgst_amt}}<br></div>
    <div v-if="item.sgst!=0">Sgst@{{item.sgst}}(Amt):{{item.sgst_amt}}<br></div>
    <div v-if="item.igst!=0">Igst@{{item.igst}}(Amt):{{item.igst_amt}}<br></div>
    <div v-if="item.cess!=0">Cess@{{item.cess}}(Amt):{{item.cess_amt}}<br></div>
</div>    
</div>
    

</div>

<hr style="border: 1px dashed black;">
       


<div v-if="print_paper.isFieldActive.customer_detail">
    <hr style="border: 1px dashed black;">


    <h3 style="text-align: center;">  Customer Detail</h3>      

         <p>
<span v-if="print_paper.isFieldActive.customer_name"><b>Name:</b> {{print_paper.sales.customer.name}}<br></span>
<span v-if="print_paper.isFieldActive.customer_phone"><b>Phone:</b>{{print_paper.sales.customer.phone}} <br></span>
<span v-if="print_paper.isFieldActive.customer_points"><b>Points:</b> {{print_paper.sales.customer.points}}<br> </span>

</div></p>
        
<hr style="border: 1px dashed black;">


<div v-if="print_paper.mode"  isat_editable_content="isat_editable_content" parm="pos_desc" class="pos_desc isat_editable_content centered" v-html="print_paper.company_info.desc"></div>
<div v-else  class="centered" v-html="print_paper.company_info.desc"></div>
<br>    
<div v-if="print_paper.mode" isat_editable_content="isat_editable_content" parm="pos_terms" class="pos_terms isat_editable_content centered" v-html="print_paper.company_info.terms"></div>
<div v-else   class="centered" v-html="print_paper.company_info.terms"></div>
      
<hr style="border: 1px dashed black;">



<p v-if="print_paper.isFieldActive.description" style="text-align:center">!!{{print_paper.company_info.description}}!!</p>
<p  v-if="print_paper.isFieldActive.terms_and_conditions" style="text-align:center">{{print_paper.company_info.terms_and_conditions}}</p>
<div class="centered" v-if="print_paper.isFieldActive.barcode">
<!-- <canvas id="barcode"></canvas> -->
</div>
<!--  
        <p class="centered">Thanks for your purchase!
            <br>isat software solutions</p>
             -->
    </div>




</div>
<div id="isat_parameter"></div>
<!-- <script src="js/barcode.js"></script> -->
<script src="isat_wygsiwyg.js"></script>
<script src="lodash.js"></script>
</body>
<script>
// import _ from 'lodash'
// import * as sales from '..'

function sales(){

    return   {
            eway_bill_no:'',
            product_type:'',
            invoice_no: "",
            date: new Date().toISOString().substr(0, 10),
            supplier_date: "",
            counter_id: 0,
            rw_type: "",
            customer: {
                id: "",
                name: "",
                phone: "",
                tax_type: "",
                gst_no: "",
                state: ""
            },
            salesman: {
                id:0,
                name: ''
            },
            cart: {

                name: "",
                unit: "",
                sales_rate: "",
                description: "",
                cgst: 0,
                sgst: 0,
                igst: 0,
                cess: 0,
                product_type:'TAXABLE',
                       eway_bill_no:'',
           },
            final_info: {
                                final_amount:0,
                payment_type:'',
                final_amount:0,
                subtotal: 0,
                //  total_ammount:0,
                tax_type: "EXCLUSIVE",

                balance_due: 0,

                total_tax: 0,
                total_amount: 0,
                round_amount_in_total: 0,
                total_discount_in_amt: 0,
                paid_amount_in_cash: 0,
                paid_amount_in_card: 0,
                shipping_charge: "",
                other_charge: ""
            },
            date_menu: false
        }

}


    const {
        ipcRenderer
    } = require('electron')

//final  bill tax percentage
total_cgst=0;
total_sgst=0;
total_igst=0;
total_cess=0;

var  editor_data={};


    new Vue({
        el: "#app",
        data: {
            mode:false,
     total_cgst:0,
     total_sgst:0,
     total_igst:0,
     total_cess:0,
     total_bill_tax:0,
     tax:{

     },


     
            add_to_cart: [],
            sales:{},
            test:'',
            paper_setup:{},
            print_paper:{
                sales:sales(),
            // sales.invoice_no
            invoice_no:'',
            date:'',
            time:'',
            isFieldActive:{},
            colomn:{},
      field:{

      },
            company_info:{
            header:'',
            desc:'',
            terms:''

            },
    header:{
    brand_name:'',
    address:'',
    contact:'',
    gst_no:'',
    description:'',
    terms_and_conditions:'',

    },
   salesman:{
            name:'',
            counter:'',
           },
           time:'',
           //brand name
          
            //details of 
             // cgst:0,
            // sgst:0,
            // igst:0,
            // cess:0,
            // total_tax:0,
payment_info:{
            subtotal:0,
             discount:0,
            total_amount:0,
            balance_due:0,
            cash_received:0,
},
  final_tax:{
total_tax_amt:0,
cgst_amt:0,
sgst_amt:0,
igst_amt:0,
cess_amt:0,
       },
      customer:{
       name:'',
       phone:'',
       points:'',
      },


            }
        },
        mounted() {
          var $vm=this;

console.log("trig")
var header=document.querySelector(".pos_header")
var description=document.querySelector(".pos_desc")
var terms=document.querySelector(".pos_terms")
    if(header){
        this.observer(header);
    }
      
    if(description){
        this.observer(description);
    }
    if(terms){
        this.observer(terms);
    }




    ipcRenderer.on('ping', (e, data) => {
    // alert("invoked webview")
    // alert(JSON.stringify(data.sales.final_info))
    // console.log("webview rendered")
    // console.log(data)
let customer_reward_point=0;
$vm.print_paper=_.cloneDeep(data);
// let total_cgst=0;
// let total_sgst=0
// let total_igst=0;
// let total_cess=0;
// let tax={};
var date = new Date();
// $vm.print_paper=data;
//get data from another window
// this.add_to_cart = data["add_to_cart"];
// this.sales=data["sales"];
// this.paper_setup=data["paper_setup"];
// this.mode=data['mode'];
// let company_info=data["company_info"];
//for compution          
//   total_cgst=this.add_to_cart.reduce((a, b) => a + parseFloat((b["cgst"]) || 0), 0);
//   total_sgst=this.add_to_cart.reduce((a, b) => a + parseFloat((b["sgst"]) || 0), 0);
//   total_igst=this.add_to_cart.reduce((a, b) => a + (parseFloat(b["igst"]) || 0), 0);
//   total_cess=this.add_to_cart.reduce((a, b) => a + (parseFloat(b["cess"]) || 0), 0);

// bill info
// $vm.print_paper=data["sales"];
// $vm.print_paper.invoice_no=$vm.sales.invoice_no;
// if($vm.print_paper.isFieldActive.barcode)
// $vm.barcode(event,$vm.print_paper.sales.invoice_no);
$vm.print_paper.date=$vm.print_paper.sales.date;
$vm.print_paper.time=date.toLocaleTimeString();;
//company info
// $vm.print_paper["company_info"]=company_info;
//isFieldActive
// $vm.print_paper["isFieldActive"]=data['isFieldActive'];

//field
// $vm.print_paper["field"]=data['field'];

// customer_reward_point=this.add_to_cart.reduce((a, b) => a + (parseFloat(b["reward_point"]) || 0), 0);

// $vm.print_paper.customer.name=$vm.sales.customer_name;
// $vm.print_paper.customer.phone=$vm.sales.customer_phone;
// $vm.print_paper.customer.points=$vm.sales.customer_reward_point;

//salesman info
// $vm.print_paper.salesman.name=$vm.sales.salesman_name;
// $vm.print_paper.salesman.counter=$vm.sales.counter_id;


//tax info
// let tax_=$vm.get_each_tax_by_total_tax_ammount($vm.sales.total_tax,total_cgst,total_sgst,total_igst,total_cess);
// tax["total_tax_amt"]=tax_.total_tax_amt;
// tax["cgst_amt"]=tax_.cgst_amt;
// tax["sgst_amt"]=tax_.sgst_amt;
// tax["igst_amt"]=tax_.igst_amt;
// tax["cess_amt"]=tax_.cess_amt;



// $vm.print_paper.subtotal=(parseFloat($vm.sales.subtotal).toFixed(2)||0);

// $vm.print_paper.discount=(parseFloat($vm.sales.total_discount_in_amt).toFixed(2)|| 0);
// $vm.print_paper.total_amount=parseFloat($vm.sales.total_amount).toFixed(2);
// $vm.print_paper.balance_due=(parseFloat($vm.sales.balance_due).toFixed(2)||0);
// $vm.print_paper.cash_received=(parseFloat($vm.sales.total_amount).toFixed(2)||0)
// $vm.print_paper['final_tax']=tax;
            })
        },
        methods: {
            getTime_(){

return new Date().toLocaleTimeString();
            },
            total_item_quantity(array){


return _.sumBy(array, (obj)=>{

return parseFloat(obj.qty)
});
            },
            no_of_items(array){

return array.length;
            },
 barcode(event,val="test"){
console.log(val)
    JsBarcode("#barcode", val, {
//   format: "pharmacode",
  width:1,
  height:40,
//   displayValue: false
});



 },     
 simple_tax_calculation(array){
var cgst_amt=0;
var sgst_amt=0;
var igst_amt=0;
var cess_amt=0;
    array.forEach(element => {
        
        cgst_amt+=parseFloat(element.cgst_amt);
        sgst_amt+=parseFloat(element.sgst_amt);
        igst_amt+=parseFloat(element.igst_amt);
        cess_amt+=parseFloat(element.cess_amt);
    });

    return {
        cgst_amt,
        sgst_amt,
        igst_amt,
        cess_amt
    }
 } ,     
sendToHost(data){

    ipcRenderer.sendToHost("readyCompanyInfo",data) 


},
observer(elem){
    var $vm=this;    
    editor_data[elem.getAttribute("parm")]=elem.innerHTML;
     
    elem.addEventListener("input",()=>{
        editor_data[elem.getAttribute("parm")]=elem.innerHTML;
     
$vm.sendToHost(editor_data);
    });



var observer=new MutationObserver(function(mutations,observer){
    
    observer.disconnect();

    editor_data[elem.getAttribute("parm")]=elem.innerHTML;

$vm.sendToHost(editor_data);
$vm.observer(elem);

})
observer.observe(elem,{childList:true});






},

            get_each_tax_by_total_tax_ammount(total_tax_amount,cgst,sgst,igst,cess)
{
    let bill_tax={};
let total_tax=(parseFloat(cgst)+parseFloat(sgst)+parseFloat(igst)+parseFloat(cess)||0);
let each_tax=(parseFloat(total_tax_amount)/parseFloat(total_tax)||0);
//apply
bill_tax["total_tax_amt"]=(parseFloat(total_tax_amount)||0);
bill_tax["cgst_amt"]=(parseFloat(cgst)*each_tax||0);
bill_tax["sgst_amt"]=(parseFloat(sgst)*each_tax||0);
bill_tax["igst_amt"]=(parseFloat(igst)*each_tax||0);
bill_tax["cess_amt"]=(parseFloat(cess)*each_tax||0);



return bill_tax;





}
        }
    })
</script>

</html>